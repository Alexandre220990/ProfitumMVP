# 📋 GUIDE D'UTILISATION COMPLET - WORKFLOWS DOCUMENTAIRES FINANCIALTRACKER

## 🎯 **Vue d'ensemble**

Ce guide détaille l'utilisation complète des 8 workflows documentaires de FinancialTracker, optimisés pour votre processus métier avec Profitum comme centre financier.

---

## 📊 **Résumé des Workflows**

| **N°** | **Workflow** | **SLA** | **Rôles** | **Étapes** | **Type** |
|--------|--------------|---------|-----------|------------|----------|
| 1 | CGV Profitum | Immédiat | Client + Admin | 2 | Page web |
| 2 | Rapport de Simulation | Immédiat | Système + Client | 2 | PDF auto |
| 3 | Rapport de Prééligibilité | 48h | Admin + Client + Expert | 3 | PDF |
| 4 | Rapport d'Éligibilité Expert | 168h | Expert + Admin + Client | 3 | PDF |
| 5 | Bon de Commande | Immédiat | Système + Admin + Client + Expert | 3 | PDF |
| 6 | Facture | Immédiat | Admin + Client + Expert | 4 | PDF |
| 7 | Suivi Administratif | 240h | Admin + Client + Expert | 5 | PDF |
| 8 | Remboursement | 48h | Admin + Client + Expert | 5 | PDF |

---

## 🔐 **Permissions par Rôle**

### **👨‍💼 ADMIN**
- ✅ **Accès complet** à tous les workflows
- ✅ **Validation** de tous les documents financiers
- ✅ **Génération** de rapports et factures
- ✅ **Suivi** de tous les processus
- ✅ **Notifications** automatiques

### **👤 CLIENT**
- ✅ **Validation** des CGV
- ✅ **Consultation** des rapports
- ✅ **Signature** électronique
- ✅ **Notifications** personnalisées
- ✅ **Accès** à l'espace documentaire

### **👨‍💼 EXPERT**
- ✅ **Analyse** et rapports d'éligibilité
- ✅ **Consultation** des dossiers clients
- ✅ **Notifications** de progression
- ✅ **Accès** aux documents pertinents

---

## 📋 **DÉTAIL DES WORKFLOWS**

---

### **1. CGV PROFITUM**

**🎯 Objectif :** Validation des Conditions Générales de Vente lors de l'inscription

**📋 Étapes :**
1. **Validation CGV** (Client)
   - Case à cocher obligatoire
   - Page publique accessible
   - Validation immédiate

2. **Confirmation inscription** (Admin)
   - Notification automatique
   - Confirmation par email
   - Activation du compte

**⏱️ SLA :** Immédiat

**📧 Notifications :**
- Client : Email de confirmation
- Admin : Notification de nouvelle inscription

**💡 Conseils d'utilisation :**
- La case CGV doit être cochée pour valider l'inscription
- Le client reçoit immédiatement une confirmation
- L'admin est notifié de chaque nouvelle inscription

---

### **2. RAPPORT DE SIMULATION**

**🎯 Objectif :** Génération automatique d'un rapport personnalisé après simulation

**📋 Étapes :**
1. **Génération rapport simulation** (Système)
   - PDF personnalisé automatique
   - Basé sur les résultats du simulateur
   - Génération immédiate

2. **Accessibilité documentaire** (Système)
   - Disponible dans l'espace client
   - Pas de notification email
   - Accès direct

**⏱️ SLA :** Immédiat

**📧 Notifications :**
- Aucune notification email (comme demandé)
- Push notification pour informer de la disponibilité

**💡 Conseils d'utilisation :**
- Le rapport est généré automatiquement après simulation
- Accessible directement dans l'espace documentaire
- Personnalisé selon les réponses du simulateur

---

### **3. RAPPORT DE PRÉÉLIGIBILITÉ**

**🎯 Objectif :** Analyse des premiers documents et notification à l'expert préselectionné

**📋 Étapes :**
1. **Génération rapport prééligibilité** (Admin)
   - Analyse des documents ClientProduitEligible
   - Rapport PDF détaillé
   - Durée : 24h

2. **Notification client et expert** (Admin)
   - Email + push notification
   - Expert préselectionné notifié
   - Client informé de la progression

3. **Partage documentaire** (Admin)
   - Accès dans l'espace client
   - Accès pour l'expert assigné
   - Partage automatique

**⏱️ SLA :** 48h

**📧 Notifications :**
- Client : Email + push
- Expert : Email + push
- Admin : Suivi complet

**💡 Conseils d'utilisation :**
- L'admin analyse les documents fournis par le client
- L'expert préselectionné est automatiquement notifié
- Le client peut suivre la progression dans son espace

---

### **4. RAPPORT D'ÉLIGIBILITÉ EXPERT**

**🎯 Objectif :** Analyse technique par l'expert (pas de validation admin)

**📋 Étapes :**
1. **Analyse et rapport expert** (Expert)
   - Analyse technique complète
   - Rapport détaillé d'éligibilité
   - Durée : 120h (5 jours)

2. **Notification client et admin** (Expert)
   - Client notifié du résultat
   - Admin en consultation (pas de validation)
   - Notifications immédiates

3. **Partage rapport final** (Expert)
   - Rapport disponible dans l'espace client
   - Accès admin en consultation
   - Partage automatique

**⏱️ SLA :** 168h (1 semaine)

**📧 Notifications :**
- Client : Email + push
- Admin : Consultation (pas de validation)
- Expert : Confirmation de partage

**💡 Conseils d'utilisation :**
- L'expert a 5 jours pour produire son rapport
- L'admin peut consulter mais ne valide pas
- Le client reçoit directement le résultat final

---

### **5. BON DE COMMANDE (ÉTAT DE REMBOURSEMENT)**

**🎯 Objectif :** Engagement Profitum à verser les montants dus

**📋 Étapes :**
1. **Génération automatique BDC** (Système)
   - Génération après rapport définitif expert
   - Engagement Profitum automatique
   - Génération immédiate

2. **Validation commerciale admin** (Admin)
   - Vérification des montants
   - Prévention d'erreurs
   - Durée : 12h

3. **Génération facture** (Admin)
   - Facture générée après validation
   - Centre financier Profitum
   - Génération immédiate

**⏱️ SLA :** Immédiat (après rapport expert)

**📧 Notifications :**
- Client : Email + push
- Expert : Email + push
- Admin : Suivi complet

**💡 Conseils d'utilisation :**
- Le BDC est généré automatiquement après le rapport expert
- L'admin doit valider pour éviter les erreurs
- Profitum s'engage à verser les montants

---

### **6. FACTURE (ATTESTATION DE VERSEMENT)**

**🎯 Objectif :** Attestation du futur versement par Profitum

**📋 Étapes :**
1. **Génération facture client** (Admin)
   - Facture client après réception fonds
   - Attestation de versement
   - Génération immédiate

2. **Génération facture expert** (Admin)
   - Facture expert après réception fonds
   - Attestation de versement
   - Génération immédiate

3. **Notification client et expert** (Admin)
   - Double système de notification
   - Centre financier Profitum
   - Notifications immédiates

4. **Partage factures** (Admin)
   - Espaces documentaires séparés
   - Client et expert ont leurs factures
   - Partage automatique

**⏱️ SLA :** Immédiat (après réception fonds)

**📧 Notifications :**
- Client : Email + push
- Expert : Email + push
- Admin : Suivi complet

**💡 Conseils d'utilisation :**
- Les factures sont générées après réception des fonds
- Double système : client et expert séparés
- Profitum atteste du futur versement

---

### **7. SUIVI ADMINISTRATIF**

**🎯 Objectif :** Suivi complet du processus administratif

**📋 Étapes :**
1. **Envoi dossier administration** (Admin)
   - Envoi à l'administration française
   - Numéro de suivi généré
   - Durée : 24h

2. **Suivi acceptation dossier** (Admin)
   - Suivi de l'acceptation
   - Mise à jour du statut
   - Durée : 72h

3. **Notification résultats** (Admin)
   - Résultats de l'administration
   - Statut de paiement
   - Durée : 24h

4. **Suivi versement** (Admin)
   - Suivi du versement des fonds
   - Statut final
   - Durée : 48h

5. **Partage rapport final** (Admin)
   - Rapport partagé avec client et expert
   - Espaces documentaires respectifs
   - Partage immédiat

**⏱️ SLA :** 240h (10 jours)

**📧 Notifications :**
- Client : Email + push + SMS
- Expert : Email + push
- Admin : Suivi complet

**💡 Conseils d'utilisation :**
- L'admin suit tout le processus administratif
- Le client et l'expert sont informés à chaque étape
- Durée totale : 10 jours maximum

---

### **8. REMBOURSEMENT**

**🎯 Objectif :** Traitement des remboursements client et expert

**📋 Étapes :**
1. **Traitement remboursement client** (Admin)
   - Calcul du montant client
   - Traitement du remboursement
   - Durée : 24h

2. **Traitement remboursement expert** (Admin)
   - Calcul du montant expert
   - Traitement du remboursement
   - Durée : 24h

3. **Émission facture remboursement client** (Admin)
   - Facture de remboursement client
   - Génération automatique
   - Génération immédiate

4. **Émission facture remboursement expert** (Admin)
   - Facture de remboursement expert
   - Génération automatique
   - Génération immédiate

5. **Notification finale remboursements** (Admin)
   - Notification aux deux parties
   - Confirmation de remboursement
   - Notification immédiate

**⏱️ SLA :** 48h

**📧 Notifications :**
- Client : Email + push + SMS
- Expert : Email + push + SMS
- Admin : Suivi complet

**💡 Conseils d'utilisation :**
- Les remboursements sont traités séparément
- Chaque partie reçoit sa facture de remboursement
- Notifications finales avec SMS

---

## 🔧 **CONFIGURATION ET UTILISATION**

### **Pour l'Admin :**

1. **Accès aux workflows :**
   ```sql
   -- Voir tous les workflows
   SELECT * FROM "WorkflowTemplate" ORDER BY name;
   
   -- Voir les étapes d'un workflow
   SELECT * FROM "WorkflowStep" 
   WHERE workflow_id = (SELECT id FROM "WorkflowTemplate" WHERE name = 'Nom du workflow')
   ORDER BY "order";
   ```

2. **Suivi des instances :**
   ```sql
   -- Voir les instances actives
   SELECT * FROM "WorkflowInstance" WHERE status = 'active';
   ```

3. **Notifications :**
   - Toutes les notifications sont automatiques
   - Configurées dans les métadonnées de chaque étape
   - Email, push, SMS selon le contexte

### **Pour le Client :**

1. **Accès à l'espace documentaire :**
   - Tous les documents sont automatiquement disponibles
   - Pas besoin de téléchargement manuel
   - Notifications automatiques

2. **Actions requises :**
   - Validation des CGV (case à cocher)
   - Signature électronique si demandée
   - Consultation des rapports

### **Pour l'Expert :**

1. **Accès aux dossiers :**
   - Dossiers assignés automatiquement
   - Notifications de nouveaux dossiers
   - Accès aux documents pertinents

2. **Actions requises :**
   - Analyse technique des dossiers
   - Production de rapports d'éligibilité
   - Respect des délais SLA

---

## 📊 **MONITORING ET SUIVI**

### **Tableau de bord Admin :**

```sql
-- Statistiques des workflows
SELECT 
    wt.name,
    COUNT(wi.id) as instances_actives,
    AVG(EXTRACT(EPOCH FROM (wi.updated_at - wi.created_at))/3600) as duree_moyenne_heures
FROM "WorkflowTemplate" wt
LEFT JOIN "WorkflowInstance" wi ON wt.id = wi.template_id
GROUP BY wt.id, wt.name
ORDER BY instances_actives DESC;
```

### **Alertes SLA :**

```sql
-- Workflows en retard
SELECT 
    wi.id,
    wt.name as workflow,
    wi.created_at,
    wt.sla_hours,
    CASE 
        WHEN EXTRACT(EPOCH FROM (NOW() - wi.created_at))/3600 > wt.sla_hours 
        THEN 'EN RETARD'
        ELSE 'DANS LES DÉLAIS'
    END as statut
FROM "WorkflowInstance" wi
JOIN "WorkflowTemplate" wt ON wi.template_id = wt.id
WHERE wi.status = 'active';
```

---

## 🚨 **DÉPANNAGE**

### **Problèmes courants :**

1. **Workflow bloqué :**
   - Vérifier les permissions utilisateur
   - Contrôler les métadonnées de l'étape
   - Vérifier les notifications

2. **Notification non reçue :**
   - Vérifier la configuration email
   - Contrôler les paramètres de notification
   - Vérifier les logs système

3. **Document non généré :**
   - Vérifier les permissions d'écriture
   - Contrôler l'espace disque
   - Vérifier les logs d'erreur

### **Logs utiles :**

```sql
-- Voir les dernières activités
SELECT 
    ws.name as etape,
    wi.status,
    wi.created_at,
    wi.updated_at
FROM "WorkflowInstance" wi
JOIN "WorkflowStep" ws ON wi.current_step_id = ws.id
ORDER BY wi.updated_at DESC
LIMIT 10;
```

---

## 📞 **SUPPORT**

### **Contacts :**
- **Admin :** Accès complet à tous les logs et configurations
- **Client :** Support via l'interface utilisateur
- **Expert :** Support technique dédié

### **Documentation technique :**
- **API Workflows :** `/api/workflows`
- **Documentation Supabase :** [Lien vers la documentation]
- **Logs système :** [Accès aux logs]

---

## 📝 **MISE À JOUR**

**Version :** 1.0  
**Date :** 9 Janvier 2025  
**Auteur :** Équipe FinancialTracker  
**Statut :** Documentation officielle

---

*Ce guide est mis à jour automatiquement lors des modifications des workflows.* 