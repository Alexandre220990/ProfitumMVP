# üìã GUIDE D'UTILISATION COMPLET - WORKFLOWS DOCUMENTAIRES FINANCIALTRACKER

## üéØ **Vue d'ensemble**

Ce guide d√©taille l'utilisation compl√®te des 8 workflows documentaires de FinancialTracker, optimis√©s pour votre processus m√©tier avec Profitum comme centre financier.

---

## üìä **R√©sum√© des Workflows**

| **N¬∞** | **Workflow** | **SLA** | **R√¥les** | **√âtapes** | **Type** |
|--------|--------------|---------|-----------|------------|----------|
| 1 | CGV Profitum | Imm√©diat | Client + Admin | 2 | Page web |
| 2 | Rapport de Simulation | Imm√©diat | Syst√®me + Client | 2 | PDF auto |
| 3 | Rapport de Pr√©√©ligibilit√© | 48h | Admin + Client + Expert | 3 | PDF |
| 4 | Rapport d'√âligibilit√© Expert | 168h | Expert + Admin + Client | 3 | PDF |
| 5 | Bon de Commande | Imm√©diat | Syst√®me + Admin + Client + Expert | 3 | PDF |
| 6 | Facture | Imm√©diat | Admin + Client + Expert | 4 | PDF |
| 7 | Suivi Administratif | 240h | Admin + Client + Expert | 5 | PDF |
| 8 | Remboursement | 48h | Admin + Client + Expert | 5 | PDF |

---

## üîê **Permissions par R√¥le**

### **üë®‚Äçüíº ADMIN**
- ‚úÖ **Acc√®s complet** √† tous les workflows
- ‚úÖ **Validation** de tous les documents financiers
- ‚úÖ **G√©n√©ration** de rapports et factures
- ‚úÖ **Suivi** de tous les processus
- ‚úÖ **Notifications** automatiques

### **üë§ CLIENT**
- ‚úÖ **Validation** des CGV
- ‚úÖ **Consultation** des rapports
- ‚úÖ **Signature** √©lectronique
- ‚úÖ **Notifications** personnalis√©es
- ‚úÖ **Acc√®s** √† l'espace documentaire

### **üë®‚Äçüíº EXPERT**
- ‚úÖ **Analyse** et rapports d'√©ligibilit√©
- ‚úÖ **Consultation** des dossiers clients
- ‚úÖ **Notifications** de progression
- ‚úÖ **Acc√®s** aux documents pertinents

---

## üìã **D√âTAIL DES WORKFLOWS**

---

### **1. CGV PROFITUM**

**üéØ Objectif :** Validation des Conditions G√©n√©rales de Vente lors de l'inscription

**üìã √âtapes :**
1. **Validation CGV** (Client)
   - Case √† cocher obligatoire
   - Page publique accessible
   - Validation imm√©diate

2. **Confirmation inscription** (Admin)
   - Notification automatique
   - Confirmation par email
   - Activation du compte

**‚è±Ô∏è SLA :** Imm√©diat

**üìß Notifications :**
- Client : Email de confirmation
- Admin : Notification de nouvelle inscription

**üí° Conseils d'utilisation :**
- La case CGV doit √™tre coch√©e pour valider l'inscription
- Le client re√ßoit imm√©diatement une confirmation
- L'admin est notifi√© de chaque nouvelle inscription

---

### **2. RAPPORT DE SIMULATION**

**üéØ Objectif :** G√©n√©ration automatique d'un rapport personnalis√© apr√®s simulation

**üìã √âtapes :**
1. **G√©n√©ration rapport simulation** (Syst√®me)
   - PDF personnalis√© automatique
   - Bas√© sur les r√©sultats du simulateur
   - G√©n√©ration imm√©diate

2. **Accessibilit√© documentaire** (Syst√®me)
   - Disponible dans l'espace client
   - Pas de notification email
   - Acc√®s direct

**‚è±Ô∏è SLA :** Imm√©diat

**üìß Notifications :**
- Aucune notification email (comme demand√©)
- Push notification pour informer de la disponibilit√©

**üí° Conseils d'utilisation :**
- Le rapport est g√©n√©r√© automatiquement apr√®s simulation
- Accessible directement dans l'espace documentaire
- Personnalis√© selon les r√©ponses du simulateur

---

### **3. RAPPORT DE PR√â√âLIGIBILIT√â**

**üéØ Objectif :** Analyse des premiers documents et notification √† l'expert pr√©selectionn√©

**üìã √âtapes :**
1. **G√©n√©ration rapport pr√©√©ligibilit√©** (Admin)
   - Analyse des documents ClientProduitEligible
   - Rapport PDF d√©taill√©
   - Dur√©e : 24h

2. **Notification client et expert** (Admin)
   - Email + push notification
   - Expert pr√©selectionn√© notifi√©
   - Client inform√© de la progression

3. **Partage documentaire** (Admin)
   - Acc√®s dans l'espace client
   - Acc√®s pour l'expert assign√©
   - Partage automatique

**‚è±Ô∏è SLA :** 48h

**üìß Notifications :**
- Client : Email + push
- Expert : Email + push
- Admin : Suivi complet

**üí° Conseils d'utilisation :**
- L'admin analyse les documents fournis par le client
- L'expert pr√©selectionn√© est automatiquement notifi√©
- Le client peut suivre la progression dans son espace

---

### **4. RAPPORT D'√âLIGIBILIT√â EXPERT**

**üéØ Objectif :** Analyse technique par l'expert (pas de validation admin)

**üìã √âtapes :**
1. **Analyse et rapport expert** (Expert)
   - Analyse technique compl√®te
   - Rapport d√©taill√© d'√©ligibilit√©
   - Dur√©e : 120h (5 jours)

2. **Notification client et admin** (Expert)
   - Client notifi√© du r√©sultat
   - Admin en consultation (pas de validation)
   - Notifications imm√©diates

3. **Partage rapport final** (Expert)
   - Rapport disponible dans l'espace client
   - Acc√®s admin en consultation
   - Partage automatique

**‚è±Ô∏è SLA :** 168h (1 semaine)

**üìß Notifications :**
- Client : Email + push
- Admin : Consultation (pas de validation)
- Expert : Confirmation de partage

**üí° Conseils d'utilisation :**
- L'expert a 5 jours pour produire son rapport
- L'admin peut consulter mais ne valide pas
- Le client re√ßoit directement le r√©sultat final

---

### **5. BON DE COMMANDE (√âTAT DE REMBOURSEMENT)**

**üéØ Objectif :** Engagement Profitum √† verser les montants dus

**üìã √âtapes :**
1. **G√©n√©ration automatique BDC** (Syst√®me)
   - G√©n√©ration apr√®s rapport d√©finitif expert
   - Engagement Profitum automatique
   - G√©n√©ration imm√©diate

2. **Validation commerciale admin** (Admin)
   - V√©rification des montants
   - Pr√©vention d'erreurs
   - Dur√©e : 12h

3. **G√©n√©ration facture** (Admin)
   - Facture g√©n√©r√©e apr√®s validation
   - Centre financier Profitum
   - G√©n√©ration imm√©diate

**‚è±Ô∏è SLA :** Imm√©diat (apr√®s rapport expert)

**üìß Notifications :**
- Client : Email + push
- Expert : Email + push
- Admin : Suivi complet

**üí° Conseils d'utilisation :**
- Le BDC est g√©n√©r√© automatiquement apr√®s le rapport expert
- L'admin doit valider pour √©viter les erreurs
- Profitum s'engage √† verser les montants

---

### **6. FACTURE (ATTESTATION DE VERSEMENT)**

**üéØ Objectif :** Attestation du futur versement par Profitum

**üìã √âtapes :**
1. **G√©n√©ration facture client** (Admin)
   - Facture client apr√®s r√©ception fonds
   - Attestation de versement
   - G√©n√©ration imm√©diate

2. **G√©n√©ration facture expert** (Admin)
   - Facture expert apr√®s r√©ception fonds
   - Attestation de versement
   - G√©n√©ration imm√©diate

3. **Notification client et expert** (Admin)
   - Double syst√®me de notification
   - Centre financier Profitum
   - Notifications imm√©diates

4. **Partage factures** (Admin)
   - Espaces documentaires s√©par√©s
   - Client et expert ont leurs factures
   - Partage automatique

**‚è±Ô∏è SLA :** Imm√©diat (apr√®s r√©ception fonds)

**üìß Notifications :**
- Client : Email + push
- Expert : Email + push
- Admin : Suivi complet

**üí° Conseils d'utilisation :**
- Les factures sont g√©n√©r√©es apr√®s r√©ception des fonds
- Double syst√®me : client et expert s√©par√©s
- Profitum atteste du futur versement

---

### **7. SUIVI ADMINISTRATIF**

**üéØ Objectif :** Suivi complet du processus administratif

**üìã √âtapes :**
1. **Envoi dossier administration** (Admin)
   - Envoi √† l'administration fran√ßaise
   - Num√©ro de suivi g√©n√©r√©
   - Dur√©e : 24h

2. **Suivi acceptation dossier** (Admin)
   - Suivi de l'acceptation
   - Mise √† jour du statut
   - Dur√©e : 72h

3. **Notification r√©sultats** (Admin)
   - R√©sultats de l'administration
   - Statut de paiement
   - Dur√©e : 24h

4. **Suivi versement** (Admin)
   - Suivi du versement des fonds
   - Statut final
   - Dur√©e : 48h

5. **Partage rapport final** (Admin)
   - Rapport partag√© avec client et expert
   - Espaces documentaires respectifs
   - Partage imm√©diat

**‚è±Ô∏è SLA :** 240h (10 jours)

**üìß Notifications :**
- Client : Email + push + SMS
- Expert : Email + push
- Admin : Suivi complet

**üí° Conseils d'utilisation :**
- L'admin suit tout le processus administratif
- Le client et l'expert sont inform√©s √† chaque √©tape
- Dur√©e totale : 10 jours maximum

---

### **8. REMBOURSEMENT**

**üéØ Objectif :** Traitement des remboursements client et expert

**üìã √âtapes :**
1. **Traitement remboursement client** (Admin)
   - Calcul du montant client
   - Traitement du remboursement
   - Dur√©e : 24h

2. **Traitement remboursement expert** (Admin)
   - Calcul du montant expert
   - Traitement du remboursement
   - Dur√©e : 24h

3. **√âmission facture remboursement client** (Admin)
   - Facture de remboursement client
   - G√©n√©ration automatique
   - G√©n√©ration imm√©diate

4. **√âmission facture remboursement expert** (Admin)
   - Facture de remboursement expert
   - G√©n√©ration automatique
   - G√©n√©ration imm√©diate

5. **Notification finale remboursements** (Admin)
   - Notification aux deux parties
   - Confirmation de remboursement
   - Notification imm√©diate

**‚è±Ô∏è SLA :** 48h

**üìß Notifications :**
- Client : Email + push + SMS
- Expert : Email + push + SMS
- Admin : Suivi complet

**üí° Conseils d'utilisation :**
- Les remboursements sont trait√©s s√©par√©ment
- Chaque partie re√ßoit sa facture de remboursement
- Notifications finales avec SMS

---

## üîß **CONFIGURATION ET UTILISATION**

### **Pour l'Admin :**

1. **Acc√®s aux workflows :**
   ```sql
   -- Voir tous les workflows
   SELECT * FROM "WorkflowTemplate" ORDER BY name;
   
   -- Voir les √©tapes d'un workflow
   SELECT * FROM "WorkflowStep" 
   WHERE workflow_id = (SELECT id FROM "WorkflowTemplate" WHERE name = 'Nom du workflow')
   ORDER BY "order";
   ```

2. **Suivi des instances :**
   ```sql
   -- Voir les instances actives
   SELECT * FROM "WorkflowInstance" WHERE status = 'active';
   ```

3. **Notifications :**
   - Toutes les notifications sont automatiques
   - Configur√©es dans les m√©tadonn√©es de chaque √©tape
   - Email, push, SMS selon le contexte

### **Pour le Client :**

1. **Acc√®s √† l'espace documentaire :**
   - Tous les documents sont automatiquement disponibles
   - Pas besoin de t√©l√©chargement manuel
   - Notifications automatiques

2. **Actions requises :**
   - Validation des CGV (case √† cocher)
   - Signature √©lectronique si demand√©e
   - Consultation des rapports

### **Pour l'Expert :**

1. **Acc√®s aux dossiers :**
   - Dossiers assign√©s automatiquement
   - Notifications de nouveaux dossiers
   - Acc√®s aux documents pertinents

2. **Actions requises :**
   - Analyse technique des dossiers
   - Production de rapports d'√©ligibilit√©
   - Respect des d√©lais SLA

---

## üìä **MONITORING ET SUIVI**

### **Tableau de bord Admin :**

```sql
-- Statistiques des workflows
SELECT 
    wt.name,
    COUNT(wi.id) as instances_actives,
    AVG(EXTRACT(EPOCH FROM (wi.updated_at - wi.created_at))/3600) as duree_moyenne_heures
FROM "WorkflowTemplate" wt
LEFT JOIN "WorkflowInstance" wi ON wt.id = wi.template_id
GROUP BY wt.id, wt.name
ORDER BY instances_actives DESC;
```

### **Alertes SLA :**

```sql
-- Workflows en retard
SELECT 
    wi.id,
    wt.name as workflow,
    wi.created_at,
    wt.sla_hours,
    CASE 
        WHEN EXTRACT(EPOCH FROM (NOW() - wi.created_at))/3600 > wt.sla_hours 
        THEN 'EN RETARD'
        ELSE 'DANS LES D√âLAIS'
    END as statut
FROM "WorkflowInstance" wi
JOIN "WorkflowTemplate" wt ON wi.template_id = wt.id
WHERE wi.status = 'active';
```

---

## üö® **D√âPANNAGE**

### **Probl√®mes courants :**

1. **Workflow bloqu√© :**
   - V√©rifier les permissions utilisateur
   - Contr√¥ler les m√©tadonn√©es de l'√©tape
   - V√©rifier les notifications

2. **Notification non re√ßue :**
   - V√©rifier la configuration email
   - Contr√¥ler les param√®tres de notification
   - V√©rifier les logs syst√®me

3. **Document non g√©n√©r√© :**
   - V√©rifier les permissions d'√©criture
   - Contr√¥ler l'espace disque
   - V√©rifier les logs d'erreur

### **Logs utiles :**

```sql
-- Voir les derni√®res activit√©s
SELECT 
    ws.name as etape,
    wi.status,
    wi.created_at,
    wi.updated_at
FROM "WorkflowInstance" wi
JOIN "WorkflowStep" ws ON wi.current_step_id = ws.id
ORDER BY wi.updated_at DESC
LIMIT 10;
```

---

## üìû **SUPPORT**

### **Contacts :**
- **Admin :** Acc√®s complet √† tous les logs et configurations
- **Client :** Support via l'interface utilisateur
- **Expert :** Support technique d√©di√©

### **Documentation technique :**
- **API Workflows :** `/api/workflows`
- **Documentation Supabase :** [Lien vers la documentation]
- **Logs syst√®me :** [Acc√®s aux logs]

---

## üìù **MISE √Ä JOUR**

**Version :** 1.0  
**Date :** 9 Janvier 2025  
**Auteur :** √âquipe FinancialTracker  
**Statut :** Documentation officielle

---

*Ce guide est mis √† jour automatiquement lors des modifications des workflows.* 