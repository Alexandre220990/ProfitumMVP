-- ============================================================================
-- VÉRIFICATION DE SÉCURITÉ POST-CORRECTIONS
-- ============================================================================
-- Date : 2025-01-28
-- Objectif : Vérifier que les corrections de sécurité n'ont pas cassé
--            les fonctionnalités existantes
-- ============================================================================

-- ============================================================================
-- 1. VÉRIFICATION DES POLITIQUES RLS
-- ============================================================================

-- Compter les tables avec RLS activé
SELECT 
  'Tables avec RLS activé' as verification,
  COUNT(*) as nombre
FROM pg_tables t
JOIN pg_class c ON c.relname = t.tablename
WHERE t.schemaname = 'public'
  AND c.relrowsecurity = true;

| verification           | nombre |
| ---------------------- | ------ |
| Tables avec RLS activé | 141    |


-- Lister les tables sans RLS (devrait être 0 pour les tables publiques)
SELECT 
  'Tables publiques SANS RLS' as verification,
  tablename as table_name
FROM pg_tables t
JOIN pg_class c ON c.relname = t.tablename
WHERE t.schemaname = 'public'
  AND c.relrowsecurity = false
  AND tablename NOT IN ('schema_migrations') -- Tables système exclues
ORDER BY tablename;

-- NO ROW SUCCES 
-- ============================================================================
-- 2. VÉRIFICATION DES VUES SANS SECURITY DEFINER
-- ============================================================================

-- Compter les vues avec SECURITY DEFINER (devrait être 0)
-- Méthode 1 : Vérifier via pg_class.reloptions
SELECT 
  'Vues avec SECURITY DEFINER (via reloptions)' as verification,
  COUNT(*) as nombre
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE n.nspname = 'public'
  AND c.relkind = 'v'
  AND c.reloptions IS NOT NULL
  AND 'security_definer=true' = ANY(c.reloptions);

  | verification                                | nombre |
| ------------------------------------------- | ------ |
| Vues avec SECURITY DEFINER (via reloptions) | 0      |

-- Méthode 2 : Lister toutes les vues avec SECURITY DEFINER
SELECT 
  'Liste des vues avec SECURITY DEFINER' as verification,
  n.nspname as schema,
  c.relname as vue,
  c.reloptions as options
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE n.nspname = 'public'
  AND c.relkind = 'v'
  AND c.reloptions IS NOT NULL
  AND 'security_definer=true' = ANY(c.reloptions)
ORDER BY c.relname;

-- NO ROW RETURNED 

-- ============================================================================
-- 3. VÉRIFICATION DE LA VUE authenticated_users
-- ============================================================================

-- Vérifier que la vue authenticated_users existe et n'expose pas auth.users
SELECT 
  'Vue authenticated_users' as verification,
  CASE 
    WHEN EXISTS (
      SELECT 1 FROM pg_views 
      WHERE viewname = 'authenticated_users' 
      AND schemaname = 'public'
    ) THEN '✅ Vue existe'
    ELSE '❌ Vue manquante'
  END as statut,
  CASE 
    WHEN EXISTS (
      SELECT 1 FROM pg_views 
      WHERE viewname = 'authenticated_users' 
      AND schemaname = 'public'
      AND definition LIKE '%auth.users%'
    ) THEN '⚠️ Expose encore auth.users'
    ELSE '✅ N''expose pas auth.users'
  END as securite;

| verification            | statut       | securite                  |
| ----------------------- | ------------ | ------------------------- |
| Vue authenticated_users | ✅ Vue existe | ✅ N'expose pas auth.users |


-- ============================================================================
-- 4. TEST D'ACCÈS UTILISATEUR (à exécuter en tant qu'utilisateur test)
-- ============================================================================

-- Ces tests doivent être exécutés avec un utilisateur authentifié
-- pour vérifier que les politiques RLS fonctionnent correctement

-- Test 1 : Un client peut voir ses propres données
-- (À exécuter avec auth.uid() = ID d'un client)
SELECT 
  'Test Client - Accès propres données' as test,
  COUNT(*) as nombre_dossiers_visibles
FROM "ClientProduitEligible" cpe
WHERE cpe."clientId" IN (
  SELECT id FROM "Client" WHERE auth_user_id = auth.uid()
);

-- Test 2 : Un expert peut voir ses propres données
-- (À exécuter avec auth.uid() = ID d'un expert)
SELECT 
  'Test Expert - Accès propres données' as test,
  COUNT(*) as nombre_assignations_visibles
FROM "ExpertProduitEligible"
WHERE expert_id IN (
  SELECT id FROM "Expert" WHERE auth_user_id = auth.uid()
);

-- Test 3 : Un admin peut voir les données admin
-- (À exécuter avec auth.uid() = ID d'un admin)
SELECT 
  'Test Admin - Accès données admin' as test,
  COUNT(*) as nombre_notifications_visibles
FROM "AdminNotification"
WHERE EXISTS (
  SELECT 1 FROM "Admin" WHERE auth_user_id = auth.uid()
);

-- ============================================================================
-- 5. VÉRIFICATION DES POLITIQUES RLS PAR TABLE
-- ============================================================================

-- Lister toutes les politiques RLS créées
SELECT 
  'Politiques RLS créées' as verification,
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual
FROM pg_policies
WHERE schemaname = 'public'
ORDER BY tablename, policyname;

| verification          | schemaname | tablename                     | policyname                                                | permissive | roles                | cmd    | qual                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| --------------------- | ---------- | ----------------------------- | --------------------------------------------------------- | ---------- | -------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Politiques RLS créées | public     | Admin                         | Admin_modify                                              | PERMISSIVE | {public}             | ALL    | ((auth_user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM "Admin" "Admin_1"
  WHERE (("Admin_1".auth_user_id = auth.uid()) AND ("Admin_1".role = 'super_admin'::text)))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Politiques RLS créées | public     | Admin                         | Admin_select                                              | PERMISSIVE | {public}             | SELECT | ((auth_user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM "Admin" "Admin_1"
  WHERE ("Admin_1".auth_user_id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | AdminAuditLog                 | Admins can view their own audit logs                      | PERMISSIVE | {public}             | SELECT | (admin_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | AdminAuditLog                 | Super admins can view all audit logs                      | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE (("Admin".id = auth.uid()) AND ("Admin".role = 'super_admin'::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | AdminAuditLog                 | System can insert audit logs                              | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | AdminNotification             | AdminNotification_select                                  | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | AdminNotificationStatus       | AdminNotificationStatus_modify                            | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | AdminNotificationStatus       | AdminNotificationStatus_select                            | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | Appointment                   | appointment_anon_select                                   | PERMISSIVE | {anon}               | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Appointment                   | appointment_auth_delete                                   | PERMISSIVE | {authenticated}      | DELETE | ((auth.uid() = "clientId") OR (auth.uid() = "expertId"))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | Appointment                   | appointment_auth_insert                                   | PERMISSIVE | {authenticated}      | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Appointment                   | appointment_auth_select                                   | PERMISSIVE | {authenticated}      | SELECT | ((auth.uid() = "clientId") OR (auth.uid() = "expertId"))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | Appointment                   | appointment_auth_update                                   | PERMISSIVE | {authenticated}      | UPDATE | ((auth.uid() = "clientId") OR (auth.uid() = "expertId"))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | ApporteurAffaires             | Admins can update candidatures                            | PERMISSIVE | {public}             | UPDATE | (((status)::text = 'candidature'::text) AND (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Politiques RLS créées | public     | ApporteurAffaires             | Admins can view candidatures                              | PERMISSIVE | {public}             | SELECT | (((status)::text = 'candidature'::text) AND (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Politiques RLS créées | public     | ApporteurAffaires             | Candidates can create candidature                         | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ApporteurAffaires             | Candidates can view own candidature                       | PERMISSIVE | {public}             | SELECT | (((status)::text = 'candidature'::text) AND ((email)::text = (auth.jwt() ->> 'email'::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ApporteurAffaires             | admin_full_access                                         | PERMISSIVE | {service_role}       | ALL    | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ApporteurAffaires             | admin_full_access_apporteur                               | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | ApporteurAffaires             | anonymous_auth_access                                     | PERMISSIVE | {anon}               | SELECT | false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Politiques RLS créées | public     | ApporteurAffaires             | apporteur_can_read_own_data                               | PERMISSIVE | {authenticated}      | SELECT | ((auth.jwt() ->> 'email'::text) = (email)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ApporteurAffaires             | apporteur_can_update_own_data                             | PERMISSIVE | {authenticated}      | UPDATE | ((auth.jwt() ->> 'email'::text) = (email)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ApporteurAffaires             | apporteur_own_data                                        | PERMISSIVE | {public}             | ALL    | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | ApporteurCommission           | admin_full_access_commission                              | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | ApporteurCommission           | apporteur_own_commissions                                 | PERMISSIVE | {public}             | ALL    | (apporteur_id IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | ApporteurNotification         | Admins can create apporteur notifications                 | PERMISSIVE | {authenticated}      | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ApporteurNotification         | Admins can delete apporteur notifications                 | PERMISSIVE | {authenticated}      | DELETE | is_admin_authenticated()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | ApporteurNotification         | Apporteurs can update their notifications                 | PERMISSIVE | {authenticated}      | UPDATE | ((EXISTS ( SELECT 1
   FROM "ApporteurAffaires" aa
  WHERE ((aa.id = "ApporteurNotification".apporteur_id) AND (aa.auth_user_id = auth.uid())))) OR is_admin_authenticated())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ApporteurNotification         | Apporteurs can view their notifications                   | PERMISSIVE | {authenticated}      | SELECT | ((EXISTS ( SELECT 1
   FROM "ApporteurAffaires" aa
  WHERE ((aa.id = "ApporteurNotification".apporteur_id) AND (aa.auth_user_id = auth.uid())))) OR is_admin_authenticated())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | Cabinet                       | Cabinet_select                                            | PERMISSIVE | {public}             | SELECT | (id IN ( SELECT cm.cabinet_id
   FROM "CabinetMember" cm
  WHERE (cm.member_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | CabinetMember                 | CabinetMember_select                                      | PERMISSIVE | {public}             | SELECT | (member_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | CabinetMemberProduit          | cabinet_member_prod_admin_only                            | PERMISSIVE | {public}             | ALL    | ((auth.uid() IS NOT NULL) AND (EXISTS ( SELECT 1
   FROM auth.users au
  WHERE ((au.id = auth.uid()) AND ((au.raw_user_meta_data ->> 'role'::text) = 'admin'::text)))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | CabinetProduitEligible        | cabinet_produit_admin_only                                | PERMISSIVE | {public}             | ALL    | ((auth.uid() IS NOT NULL) AND (EXISTS ( SELECT 1
   FROM auth.users au
  WHERE ((au.id = auth.uid()) AND ((au.raw_user_meta_data ->> 'role'::text) = 'admin'::text)))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | CabinetTeamStat               | CabinetTeamStat_select                                    | PERMISSIVE | {public}             | SELECT | (cabinet_id IN ( SELECT cm.cabinet_id
   FROM "CabinetMember" cm
  WHERE (cm.member_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | CalendarPreferences           | Users can manage their own preferences                    | PERMISSIVE | {public}             | ALL    | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Admins have full access to Client                         | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | Client                        | Apporteurs can update their prospects                     | PERMISSIVE | {public}             | UPDATE | (apporteur_id IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | Client                        | Apporteurs can view their prospects                       | PERMISSIVE | {public}             | SELECT | (apporteur_id IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | Client                        | Client DELETE own data                                    | PERMISSIVE | {public}             | DELETE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Client INSERT own data                                    | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Client                        | Client SELECT own data                                    | PERMISSIVE | {public}             | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Clients can update own data                               | PERMISSIVE | {public}             | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Clients can view own data                                 | PERMISSIVE | {public}             | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Clients: Accès personnel                                  | PERMISSIVE | {public}             | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Clients: Modification personnelle                         | PERMISSIVE | {public}             | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Enable all operations for service_role                    | PERMISSIVE | {public}             | ALL    | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Client                        | Enable read for authenticated users                       | PERMISSIVE | {public}             | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Enable update for authenticated users                     | PERMISSIVE | {public}             | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | Service role can insert                                   | PERMISSIVE | {service_role}       | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Client                        | client_anon_insert                                        | PERMISSIVE | {anon}               | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Client                        | client_anon_select                                        | PERMISSIVE | {anon}               | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Client                        | client_auth_delete                                        | PERMISSIVE | {authenticated}      | DELETE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | client_auth_select                                        | PERMISSIVE | {authenticated}      | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Client                        | client_auth_update                                        | PERMISSIVE | {authenticated}      | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | ClientExpert                  | Apporteurs can view prospect experts                      | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".apporteur_id IN ( SELECT "ApporteurAffaires".id
           FROM "ApporteurAffaires"
          WHERE ("ApporteurAffaires".auth_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | ClientExpert                  | Apporteurs can view their client expert assignments       | PERMISSIVE | {public}             | SELECT | (assigned_by IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ClientExpert                  | Clients can view assigned experts                         | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ClientExpert                  | Experts can view assigned clients                         | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ClientExpert                  | Experts can view their assignments                        | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ClientNotification            | Admins can create client notifications                    | PERMISSIVE | {authenticated}      | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ClientNotification            | Admins can delete client notifications                    | PERMISSIVE | {authenticated}      | DELETE | is_admin_authenticated()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | ClientNotification            | Clients can update their notifications                    | PERMISSIVE | {authenticated}      | UPDATE | ((EXISTS ( SELECT 1
   FROM "Client" c
  WHERE ((c.id = "ClientNotification".client_id) AND (c.auth_user_id = auth.uid())))) OR is_admin_authenticated())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | ClientNotification            | Clients can view their notifications                      | PERMISSIVE | {authenticated}      | SELECT | ((EXISTS ( SELECT 1
   FROM "Client" c
  WHERE ((c.id = "ClientNotification".client_id) AND (c.auth_user_id = auth.uid())))) OR is_admin_authenticated())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | ClientProcessDocument         | admin_all_client_process_documents                        | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ClientProcessDocument         | apporteur_view_own_client_documents                       | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".apporteur_id IN ( SELECT "ApporteurAffaires".id
           FROM "ApporteurAffaires"
          WHERE ("ApporteurAffaires".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ClientProcessDocument         | client_view_own_process_documents                         | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | ClientProcessDocument         | expert_view_assigned_client_documents                     | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM ("Expert" e
     JOIN "ClientProduitEligible" cpe ON ((cpe.expert_id = e.id)))
  WHERE ((e.auth_user_id = auth.uid()) AND (cpe."clientId" = (("ClientProcessDocument".client_id)::text)::uuid) AND (cpe."produitId" = (("ClientProcessDocument".produit_id)::text)::uuid))))                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | ClientProduitEligible         | Admins have full access to ClientProduitEligible          | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ClientProduitEligible         | Allow insert for temporary clients                        | PERMISSIVE | {anon,authenticated} | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ClientProduitEligible         | Allow service role to insert                              | PERMISSIVE | {service_role}       | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ClientProduitEligible         | Apporteurs can view prospect products                     | PERMISSIVE | {public}             | SELECT | ("clientId" IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".apporteur_id IN ( SELECT "ApporteurAffaires".id
           FROM "ApporteurAffaires"
          WHERE ("ApporteurAffaires".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | ClientProduitEligible         | ClientProduitEligible_delete_policy                       | PERMISSIVE | {authenticated}      | DELETE | (EXISTS ( SELECT 1
   FROM "Client"
  WHERE (("Client".id = "ClientProduitEligible"."clientId") AND ("Client".email = (auth.jwt() ->> 'email'::text)))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | ClientProduitEligible         | ClientProduitEligible_insert_policy                       | PERMISSIVE | {authenticated}      | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ClientProduitEligible         | ClientProduitEligible_select_policy                       | PERMISSIVE | {authenticated}      | SELECT | ((EXISTS ( SELECT 1
   FROM "Client"
  WHERE (("Client".id = "ClientProduitEligible"."clientId") AND ("Client".email = (auth.jwt() ->> 'email'::text))))) OR (EXISTS ( SELECT 1
   FROM "Expert"
  WHERE (("Expert".id = "ClientProduitEligible".expert_id) AND ("Expert".email = (auth.jwt() ->> 'email'::text))))))                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Politiques RLS créées | public     | ClientProduitEligible         | ClientProduitEligible_update_policy                       | PERMISSIVE | {authenticated}      | UPDATE | ((EXISTS ( SELECT 1
   FROM "Client"
  WHERE (("Client".id = "ClientProduitEligible"."clientId") AND ("Client".email = (auth.jwt() ->> 'email'::text))))) OR (EXISTS ( SELECT 1
   FROM "Expert"
  WHERE (("Expert".id = "ClientProduitEligible".expert_id) AND ("Expert".email = (auth.jwt() ->> 'email'::text))))))                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Politiques RLS créées | public     | ClientProduitEligible         | Clients can view own products                             | PERMISSIVE | {public}             | SELECT | ("clientId" IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Politiques RLS créées | public     | ClientProduitEligible         | Enable insert for authenticated users                     | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ClientProduitEligible         | Enable read for authenticated users                       | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = ("clientId")::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | ClientProduitEligibleShare    | ClientProduitEligibleShare_select                         | PERMISSIVE | {public}             | SELECT | (client_produit_eligible_id IN ( SELECT cpe.id
   FROM "ClientProduitEligible" cpe
  WHERE (cpe."clientId" IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ClientStatut                  | Apporteurs can view their client statuses                 | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".apporteur_id IN ( SELECT "ApporteurAffaires".id
           FROM "ApporteurAffaires"
          WHERE ("ApporteurAffaires".auth_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | ComplianceControl             | Admins can manage compliance controls                     | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | ComplianceControl             | Users can view compliance controls                        | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | DFSQuestions                  | DFSQuestions_modify                                       | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | DFSQuestions                  | DFSQuestions_select                                       | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | DFSRules                      | DFSRules_modify                                           | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | DFSRules                      | DFSRules_select                                           | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | DocumentActivity              | document_activity_sections_insert_policy                  | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | DocumentActivity              | document_activity_sections_read_policy                    | PERMISSIVE | {public}             | SELECT | ((auth.role() = 'authenticated'::text) AND ((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM ("Expert" e
     JOIN "Dossier" d ON ((e.id = d."expertId")))
  WHERE ((e.id = auth.uid()) AND (d."clientId" = "DocumentActivity".user_id))))))                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Politiques RLS créées | public     | Dossier                       | Admins have full access to Dossier                        | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | Dossier                       | Apporteurs can view prospect dossiers                     | PERMISSIVE | {public}             | SELECT | ("clientId" IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".apporteur_id IN ( SELECT "ApporteurAffaires".id
           FROM "ApporteurAffaires"
          WHERE ("ApporteurAffaires".auth_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | Dossier                       | Clients can view own dossiers                             | PERMISSIVE | {public}             | SELECT | ("clientId" IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | Dossier                       | Experts can view assigned dossiers                        | PERMISSIVE | {public}             | SELECT | ("expertId" IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | DossierComment                | Experts can view their dossier comments                   | PERMISSIVE | {public}             | SELECT | ((visible_to_expert = true) AND (dossier_id IN ( SELECT "ClientProduitEligible".id
   FROM "ClientProduitEligible"
  WHERE ("ClientProduitEligible".expert_id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | DossierHistorique             | DossierHistorique_select                                  | PERMISSIVE | {public}             | SELECT | (dossier_id IN ( SELECT cpe.id
   FROM "ClientProduitEligible" cpe
  WHERE (cpe."clientId" IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | EligibilityChanges            | EligibilityChanges_modify                                 | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | EligibilityChanges            | EligibilityChanges_select                                 | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | EligibilityRules              | EligibilityRules_modify                                   | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | EligibilityRules              | EligibilityRules_select                                   | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | EmailEvent                    | email_event_admin_only                                    | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | EmailQueue                    | email_queue_admin_only                                    | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | EmailTracking                 | email_tracking_admin_only                                 | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | EventInvitation               | EventInvitation_select                                    | PERMISSIVE | {public}             | SELECT | ((EXISTS ( SELECT 1
   FROM "Client"
  WHERE (("Client".auth_user_id = auth.uid()) AND ("Client".email = ("EventInvitation".email)::text)))) OR (EXISTS ( SELECT 1
   FROM "Expert"
  WHERE (("Expert".auth_user_id = auth.uid()) AND ("Expert".email = ("EventInvitation".email)::text)))) OR (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE (("Admin".auth_user_id = auth.uid()) AND ("Admin".email = ("EventInvitation".email)::text)))))                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | Expert                        | Expert DELETE own data                                    | PERMISSIVE | {public}             | DELETE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | Expert INSERT own data                                    | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Expert                        | Expert SELECT own data                                    | PERMISSIVE | {public}             | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | Expert UPDATE own data                                    | PERMISSIVE | {public}             | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | Experts can update own profile                            | PERMISSIVE | {authenticated}      | UPDATE | ((auth.uid() = auth_user_id) OR ((auth.uid())::text = (id)::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | Expert                        | Experts can view own profile                              | PERMISSIVE | {authenticated}      | SELECT | ((auth.uid() = auth_user_id) OR ((auth.uid())::text = (id)::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | Expert                        | Experts: Accès personnel                                  | PERMISSIVE | {public}             | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | Experts: Modification personnelle                         | PERMISSIVE | {public}             | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | Public can view approved experts                          | PERMISSIVE | {anon}               | SELECT | ((approval_status = 'approved'::text) AND (status = 'active'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Expert                        | Service role can do anything on Expert                    | PERMISSIVE | {service_role}       | ALL    | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Expert                        | expert_anon_insert                                        | PERMISSIVE | {anon}               | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Expert                        | expert_anon_select                                        | PERMISSIVE | {anon}               | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Expert                        | expert_auth_delete                                        | PERMISSIVE | {authenticated}      | DELETE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | expert_auth_select                                        | PERMISSIVE | {authenticated}      | SELECT | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | Expert                        | expert_auth_update                                        | PERMISSIVE | {authenticated}      | UPDATE | (auth.uid() = auth_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | ExpertAlert                   | ExpertAlert_select                                        | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | ExpertCategory                | ExpertCategory_modify                                     | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ExpertCategory                | ExpertCategory_select                                     | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ExpertNotification            | Apporteurs can view their sent notifications              | PERMISSIVE | {public}             | SELECT | (apporteur_id IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | ExpertNotification            | Experts can view their notifications                      | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ExpertNotification            | admin_full_access_expert_notification                     | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | ExpertNotification            | expert_own_notifications                                  | PERMISSIVE | {public}             | ALL    | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | ExpertProduitEligible         | ExpertProduitEligible_select                              | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | GEDDocument                   | ged_document_client_insert_policy                         | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | GEDDocument                   | ged_document_client_read_policy                           | PERMISSIVE | {public}             | SELECT | (((current_setting('app.user_type'::text, true) = 'client'::text) AND (created_by = (current_setting('app.user_id'::text, true))::uuid)) OR (current_setting('app.user_type'::text, true) = 'admin'::text) OR (current_setting('app.user_type'::text, true) = 'expert'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | GEDDocument                   | ged_document_delete_policy                                | PERMISSIVE | {public}             | DELETE | (current_setting('app.user_type'::text, true) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | GEDDocument                   | ged_document_read_policy                                  | PERMISSIVE | {public}             | SELECT | ((EXISTS ( SELECT 1
   FROM "GEDDocumentPermission" dp
  WHERE ((dp.document_id = "GEDDocument".id) AND ((dp.user_type)::text = current_setting('app.user_type'::text, true)) AND (dp.can_read = true)))) OR (current_setting('app.user_type'::text, true) = 'admin'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Politiques RLS créées | public     | GEDDocument                   | ged_document_write_policy                                 | PERMISSIVE | {public}             | UPDATE | ((current_setting('app.user_type'::text, true) = 'admin'::text) OR (created_by = auth.uid()))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | GEDDocumentLabel              | ged_document_label_read_policy                            | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | GEDDocumentLabel              | ged_document_label_write_policy                           | PERMISSIVE | {public}             | ALL    | (current_setting('app.user_type'::text, true) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | GEDDocumentPermission         | ged_document_permission_policy                            | PERMISSIVE | {public}             | ALL    | (current_setting('app.user_type'::text, true) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | GEDDocumentVersion            | ged_document_version_read_policy                          | PERMISSIVE | {public}             | SELECT | ((EXISTS ( SELECT 1
   FROM "GEDDocumentPermission" dp
  WHERE ((dp.document_id = "GEDDocumentVersion".document_id) AND ((dp.user_type)::text = current_setting('app.user_type'::text, true)) AND (dp.can_read = true)))) OR (current_setting('app.user_type'::text, true) = 'admin'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Politiques RLS créées | public     | GEDDocumentVersion            | ged_document_version_write_policy                         | PERMISSIVE | {public}             | ALL    | ((current_setting('app.user_type'::text, true) = 'admin'::text) OR (modified_by = auth.uid()))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | GEDUserDocumentFavorite       | ged_user_document_favorite_policy                         | PERMISSIVE | {public}             | ALL    | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | GoogleCalendarIntegration     | GoogleCalendarIntegration_select                          | PERMISSIVE | {public}             | SELECT | (user_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())
UNION
 SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | GoogleCalendarSyncLog         | GoogleCalendarSyncLog_select                              | PERMISSIVE | {public}             | SELECT | (integration_id IN ( SELECT gci.id
   FROM "GoogleCalendarIntegration" gci
  WHERE (gci.user_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid())
        UNION
         SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | ProductCalculationRules       | Public read access to calculation rules                   | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ProductSpecificRates          | Public read access to specific rates                      | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ProduitEligible               | Enable all operations for service_role                    | PERMISSIVE | {public}             | ALL    | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ProduitEligible               | Enable read for all users                                 | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | ProduitEligible               | produit_eligible_anon_select                              | PERMISSIVE | {anon}               | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Question                      | question_anon_select                                      | PERMISSIVE | {anon}               | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | QuestionExploration           | QuestionExploration_modify                                | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | QuestionExploration           | QuestionExploration_select                                | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | QuestionnaireQuestion         | Public read access to questionnaire questions             | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | RDV                           | Apporteurs can manage their client meetings               | PERMISSIVE | {public}             | ALL    | (apporteur_id IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | RDV                           | Experts can view their meetings                           | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | RDV                           | rdv_insert_apporteur                                      | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | RDV                           | rdv_insert_client                                         | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | RDV                           | rdv_insert_expert                                         | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | RDV                           | rdv_select_admin                                          | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | RDV                           | rdv_update_participants                                   | PERMISSIVE | {public}             | UPDATE | ((client_id = auth.uid()) OR (expert_id = auth.uid()) OR (apporteur_id = auth.uid()))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Politiques RLS créées | public     | RDV_Invitations               | RDV_Invitations_select                                    | PERMISSIVE | {public}             | SELECT | ((invitee_email)::text IN ( SELECT "Client".email
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())
UNION
 SELECT "Expert".email
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())
UNION
 SELECT "Admin".email
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | RDV_Participants              | RDV_Participants_select                                   | PERMISSIVE | {public}             | SELECT | (user_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())
UNION
 SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | RDV_Produits                  | Apporteurs can manage their prospect meeting products     | PERMISSIVE | {public}             | ALL    | (rdv_id IN ( SELECT "RDV".id
   FROM "RDV"
  WHERE ("RDV".apporteur_id = ( SELECT "ApporteurAffaires".id
           FROM "ApporteurAffaires"
          WHERE ("ApporteurAffaires".auth_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | RDV_Produits                  | Clients can view their meeting products                   | PERMISSIVE | {public}             | SELECT | (client_produit_eligible_id IN ( SELECT "ClientProduitEligible".id
   FROM "ClientProduitEligible"
  WHERE ("ClientProduitEligible"."clientId" = ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | RDV_Produits                  | Experts can view their meeting products                   | PERMISSIVE | {public}             | SELECT | (rdv_id IN ( SELECT "RDV".id
   FROM "RDV"
  WHERE ("RDV".expert_id = ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | RDV_Produits                  | rdv_produits_delete                                       | PERMISSIVE | {public}             | DELETE | (EXISTS ( SELECT 1
   FROM "RDV"
  WHERE (("RDV".id = "RDV_Produits".rdv_id) AND (("RDV".apporteur_id = auth.uid()) OR ("RDV".expert_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | RDV_Produits                  | rdv_produits_insert                                       | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | RDV_Produits                  | rdv_produits_select                                       | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "RDV"
  WHERE (("RDV".id = "RDV_Produits".rdv_id) AND (("RDV".client_id = auth.uid()) OR ("RDV".expert_id = auth.uid()) OR ("RDV".apporteur_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | RDV_Produits                  | rdv_produits_update                                       | PERMISSIVE | {public}             | UPDATE | (EXISTS ( SELECT 1
   FROM "RDV"
  WHERE (("RDV".id = "RDV_Produits".rdv_id) AND (("RDV".apporteur_id = auth.uid()) OR ("RDV".expert_id = auth.uid())))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | RDV_Reminders                 | RDV_Reminders_select                                      | PERMISSIVE | {public}             | SELECT | (rdv_id IN ( SELECT r.id
   FROM "RDV" r
  WHERE ((r.client_id IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid()))) OR (r.expert_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid()))))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | RDV_Report                    | RDV_Report_select                                         | PERMISSIVE | {public}             | SELECT | (rdv_id IN ( SELECT r.id
   FROM "RDV" r
  WHERE ((r.client_id IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid()))) OR (r.expert_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid()))))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | RDV_Task                      | RDV_Task_select                                           | PERMISSIVE | {public}             | SELECT | ((expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid()))) OR (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid()))) OR (apporteur_id IN ( SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_user_id = auth.uid()))) OR (created_by IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())
UNION
 SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())
UNION
 SELECT "ApporteurAffaires".id
   FROM "ApporteurAffaires"
  WHERE ("ApporteurAffaires".auth_user_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))) |
| Politiques RLS créées | public     | RDV_Timeline                  | RDV_Timeline_select                                       | PERMISSIVE | {public}             | SELECT | (rdv_id IN ( SELECT r.id
   FROM "RDV" r
  WHERE ((r.client_id IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid()))) OR (r.expert_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid()))))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | Reminder                      | Admins can create reminders                               | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | Reminder                      | Admins can view all reminders                             | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | Reminder                      | Clients can update their own reminders                    | PERMISSIVE | {public}             | UPDATE | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | Reminder                      | Clients can view their own reminders                      | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | Reminder                      | Experts can update their own reminders                    | PERMISSIVE | {public}             | UPDATE | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | Reminder                      | Experts can view their own reminders                      | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | SharedClientDocument          | SharedClientDocument_select                               | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | SimulationProcessed           | Users can view their own processed simulations            | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (clientid)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | SimulatorFollowUp             | admin_access_followup                                     | PERMISSIVE | {authenticated}      | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | Specialization                | Specialization_modify                                     | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | Specialization                | Specialization_select                                     | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPEAdvancedRules            | TICPEAdvancedRules_select                                 | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPEBenchmarks               | TICPEBenchmarks_select                                    | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPERates                    | TICPERates_select                                         | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPESectors                  | TICPESectors_select                                       | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPESimulationResults        | TICPESimulationResults_select                             | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPEUsageScenarios           | TICPEUsageScenarios_select                                | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | TICPEVehicleTypes             | TICPEVehicleTypes_select                                  | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | UserDevices                   | Users can delete their own devices                        | PERMISSIVE | {public}             | DELETE | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | UserDevices                   | Users can insert their own devices                        | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | UserDevices                   | Users can update their own devices                        | PERMISSIVE | {public}             | UPDATE | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | UserDevices                   | Users can view their own devices                          | PERMISSIVE | {public}             | SELECT | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | UserMessagingPreferences      | UserMessagingPreferences_select                           | PERMISSIVE | {public}             | SELECT | (user_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())
UNION
 SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | UserNotificationPreferences   | Users can insert their own preferences                    | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | UserNotificationPreferences   | Users can update their own preferences                    | PERMISSIVE | {public}             | UPDATE | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | UserNotificationPreferences   | Users can view their own preferences                      | PERMISSIVE | {public}             | SELECT | (user_id = auth.uid())                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | ValidationState               | ValidationState_modify                                    | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | ValidationState               | ValidationState_select                                    | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | WorkflowInstance              | Admins can manage workflow instances                      | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | WorkflowInstance              | Users can view their own workflow instances               | PERMISSIVE | {public}             | SELECT | (((auth.uid())::text = (client_id)::text) OR ((auth.uid())::text = (expert_id)::text) OR ((auth.jwt() ->> 'role'::text) = 'admin'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | WorkflowTemplate              | Admins can manage workflow templates                      | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | WorkflowTemplate              | Users can view active workflow templates                  | PERMISSIVE | {public}             | SELECT | (is_active = true)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | access_logs                   | System can insert access logs                             | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | admin_messages                | Admins can update all admin messages                      | PERMISSIVE | {public}             | UPDATE | (EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'type'::text) = 'admin'::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | admin_messages                | Admins can view all admin messages                        | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'type'::text) = 'admin'::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | admin_messages                | Users can insert their own admin messages                 | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | admin_messages                | Users can view their own admin messages                   | PERMISSIVE | {public}             | SELECT | ((sender_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'type'::text) = 'admin'::text)))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | audit_documents               | audit_documents_select                                    | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | audit_logs                    | Admins can view all audit logs                            | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'type'::text) = 'admin'::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | audit_logs                    | System can insert audit logs                              | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | availability_metrics          | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | client_charte_signature       | client_charte_signature_select                            | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | client_timeline               | client_timeline_select                                    | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | compliance_reports            | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | contact_messages              | Allow admin read                                          | PERMISSIVE | {authenticated}      | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | contact_messages              | Allow admin update                                        | PERMISSIVE | {authenticated}      | UPDATE | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | contact_messages              | Allow public insert                                       | PERMISSIVE | {anon,authenticated} | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | contact_messages              | Allow service role insert                                 | PERMISSIVE | {service_role}       | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | contact_messages              | Allow service role read                                   | PERMISSIVE | {service_role}       | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | contact_messages              | Allow service role update                                 | PERMISSIVE | {service_role}       | UPDATE | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | conversations                 | conversations_select                                      | PERMISSIVE | {public}             | SELECT | ((client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid()))) OR (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Politiques RLS créées | public     | datasubjectrequest            | Admins can manage data subject requests                   | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | datasubjectrequest            | Users can view their data subject requests                | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (subject_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | document_request              | document_request_select                                   | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | document_sections             | document_sections_read_policy                             | PERMISSIVE | {public}             | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Politiques RLS créées | public     | document_sections             | document_sections_write_policy                            | PERMISSIVE | {public}             | ALL    | ((auth.role() = 'authenticated'::text) AND (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | dossier_timeline              | timeline_admin_all                                        | PERMISSIVE | {authenticated}      | ALL    | (EXISTS ( SELECT 1
   FROM "Admin" a
  WHERE (a.auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Politiques RLS créées | public     | dossier_timeline              | timeline_apporteur_select                                 | PERMISSIVE | {authenticated}      | SELECT | (EXISTS ( SELECT 1
   FROM (("ClientProduitEligible" cpe
     JOIN "Client" c ON ((cpe."clientId" = c.id)))
     JOIN "ApporteurAffaires" aa ON ((c.apporteur_id = aa.id)))
  WHERE ((cpe.id = dossier_timeline.dossier_id) AND (aa.auth_user_id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | dossier_timeline              | timeline_client_select                                    | PERMISSIVE | {authenticated}      | SELECT | (EXISTS ( SELECT 1
   FROM ("ClientProduitEligible" cpe
     JOIN "Client" c ON ((cpe."clientId" = c.id)))
  WHERE ((cpe.id = dossier_timeline.dossier_id) AND (c.auth_user_id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | dossier_timeline              | timeline_expert_insert                                    | PERMISSIVE | {authenticated}      | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | dossier_timeline              | timeline_expert_select                                    | PERMISSIVE | {authenticated}      | SELECT | (EXISTS ( SELECT 1
   FROM ("ClientProduitEligible" cpe
     JOIN "Expert" e ON ((cpe.expert_id = e.id)))
  WHERE ((cpe.id = dossier_timeline.dossier_id) AND (e.auth_user_id = auth.uid()))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | event_count                   | event_count_select                                        | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | expert_client_email_scheduled | Admins can do everything on expert_client_email_scheduled | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | expert_client_email_scheduled | Experts can manage their own scheduled emails             | PERMISSIVE | {public}             | ALL    | (((auth.jwt() ->> 'user_type'::text) = 'expert'::text) AND ((expert_id)::text = (auth.jwt() ->> 'database_id'::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | expert_client_email_sequences | Admins can do everything on expert_client_email_sequences | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | expert_client_email_sequences | Experts can manage their own sequences                    | PERMISSIVE | {public}             | ALL    | (((auth.jwt() ->> 'user_type'::text) = 'expert'::text) AND ((expert_id)::text = (auth.jwt() ->> 'database_id'::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | expert_client_emails          | Admins can do everything on expert_client_emails          | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | expert_client_emails          | Experts can view their own emails                         | PERMISSIVE | {public}             | SELECT | (((auth.jwt() ->> 'user_type'::text) = 'expert'::text) AND ((expert_id)::text = (auth.jwt() ->> 'database_id'::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | expert_client_emails_received | Admins can do everything on expert_client_emails_received | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | expert_client_emails_received | Experts can view replies to their emails                  | PERMISSIVE | {public}             | SELECT | (((auth.jwt() ->> 'user_type'::text) = 'expert'::text) AND ((expert_id)::text = (auth.jwt() ->> 'database_id'::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | expertaccesslog               | Admins can view all access logs                           | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | expertaccesslog               | Experts can view their own access logs                    | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Politiques RLS créées | public     | expertaccesslog               | System can insert access logs                             | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | expertassignment              | Admins can view all assignments                           | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | expertassignment              | Clients can view their assignments                        | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | expertassignment              | Enable read access for authenticated users                | PERMISSIVE | {public}             | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Politiques RLS créées | public     | expertassignment              | Experts and admins can manage assignments                 | PERMISSIVE | {public}             | ALL    | ((expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | expertassignment              | Experts can view their assignments                        | PERMISSIVE | {public}             | SELECT | (expert_id IN ( SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | expertcampaign                | Admins can manage all campaigns                           | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | expertcampaign                | Anyone can view active campaigns                          | PERMISSIVE | {public}             | SELECT | (is_active = true)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | expertcriteria                | Admins can manage all criteria                            | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | expertcriteria                | Anyone can view active criteria                           | PERMISSIVE | {public}             | SELECT | (is_active = true)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | health_checks                 | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | import_history                | import_history_select                                     | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | import_mapping_config         | import_mapping_config_select                              | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | import_templates              | import_templates_select                                   | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | invoice                       | Admins can manage invoices                                | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | invoice                       | Users can view their invoices                             | PERMISSIVE | {public}             | SELECT | (((auth.uid())::text = (client_id)::text) OR ((auth.uid())::text = (expert_id)::text) OR ((auth.jwt() ->> 'role'::text) = 'admin'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Politiques RLS créées | public     | iso_reports                   | Admins can view all ISO reports                           | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'type'::text) = 'admin'::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | iso_reports                   | System can insert ISO reports                             | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | lead_participants             | lead_participants_select                                  | PERMISSIVE | {public}             | SELECT | (user_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())
UNION
 SELECT "Expert".id
   FROM "Expert"
  WHERE ("Expert".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Politiques RLS créées | public     | message_files                 | message_files_select                                      | PERMISSIVE | {public}             | SELECT | (message_id IN ( SELECT m.id
   FROM messages m
  WHERE (m.conversation_id IN ( SELECT c.id
           FROM conversations c
          WHERE ((c.client_id IN ( SELECT "Client".id
                   FROM "Client"
                  WHERE ("Client".auth_user_id = auth.uid()))) OR (c.expert_id IN ( SELECT "Expert".id
                   FROM "Expert"
                  WHERE ("Expert".auth_user_id = auth.uid()))))))))                                                                                                                                                                                                                                                                                                                                   |
| Politiques RLS créées | public     | messages                      | messages_select                                           | PERMISSIVE | {public}             | SELECT | (conversation_id IN ( SELECT c.id
   FROM conversations c
  WHERE ((c.client_id IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid()))) OR (c.expert_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid()))))))                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | notification                  | Users can create their own notifications                  | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | notification                  | Users can delete their own notifications                  | PERMISSIVE | {public}             | DELETE | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | notification                  | Users can update their own notifications                  | PERMISSIVE | {public}             | UPDATE | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | notification                  | Users can view their own notifications                    | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | notification_group_members    | Users can view their own group memberships                | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | notification_groups           | notification_groups_select                                | PERMISSIVE | {public}             | SELECT | ((EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM notification_group_members ngm
  WHERE ((ngm.group_id = notification_groups.id) AND (ngm.user_id IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid())
        UNION
         SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid())))))))                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | notification_metrics          | Users can view their own notification metrics             | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | notification_preferences      | Users can manage their own notification preferences       | PERMISSIVE | {public}             | ALL    | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | notification_preferences      | Users can view their own notification preferences         | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | paymentrequest                | Admins can manage payment requests                        | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | paymentrequest                | Users can view their payment requests                     | PERMISSIVE | {public}             | SELECT | ((EXISTS ( SELECT 1
   FROM invoice i
  WHERE ((i.id = paymentrequest.invoice_id) AND (((i.client_id)::text = (auth.uid())::text) OR ((i.expert_id)::text = (auth.uid())::text))))) OR ((auth.jwt() ->> 'role'::text) = 'admin'::text))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Politiques RLS créées | public     | promotionbanner               | Admins can manage all banners                             | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | promotionbanner               | Anyone can view active banners                            | PERMISSIVE | {public}             | SELECT | (is_active = true)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | prospect_email_received       | Admins can do everything on prospect_email_received       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | prospect_email_scheduled      | prospect_email_scheduled_select                           | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | prospect_email_sequence_steps | prospect_email_sequence_steps_select                      | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | prospect_email_sequences      | prospect_email_sequences_select                           | PERMISSIVE | {public}             | SELECT | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | prospect_report_history       | Admins and experts can view report history                | PERMISSIVE | {public}             | SELECT | ((auth.jwt() ->> 'user_type'::text) = ANY (ARRAY['admin'::text, 'expert'::text]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | prospect_reports              | Admins and experts can manage prospect reports            | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'user_type'::text) = ANY (ARRAY['admin'::text, 'expert'::text]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Politiques RLS créées | public     | prospects                     | prospects_admin_all                                       | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | prospects_emails              | prospects_emails_admin_all                                | PERMISSIVE | {public}             | ALL    | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".email = (( SELECT users.email
           FROM auth.users
          WHERE (users.id = auth.uid())))::text)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | pushnotification              | Admins can manage push notifications                      | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | pushnotification              | Users can view their push notifications                   | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | report_jobs                   | report_jobs_select                                        | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM "Admin"
  WHERE ("Admin".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Politiques RLS créées | public     | security_incidents            | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | security_vulnerabilities      | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | signaturerequest              | Admins can manage signature requests                      | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | simulationhistory             | simulationhistory_select                                  | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | simulations                   | simulations_select                                        | PERMISSIVE | {public}             | SELECT | (client_id IN ( SELECT "Client".id
   FROM "Client"
  WHERE ("Client".auth_user_id = auth.uid())))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | system_alerts                 | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | system_metrics                | Admins can view all monitoring data                       | PERMISSIVE | {public}             | ALL    | ((auth.jwt() ->> 'role'::text) = 'admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Politiques RLS créées | public     | terminal_logs                 | Admins can view all terminal logs                         | PERMISSIVE | {public}             | SELECT | (EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'type'::text) = 'admin'::text))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Politiques RLS créées | public     | terminal_logs                 | System can insert terminal logs                           | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | typing_indicators             | typing_indicators_select                                  | PERMISSIVE | {public}             | SELECT | (conversation_id IN ( SELECT c.id
   FROM conversations c
  WHERE ((c.client_id IN ( SELECT "Client".id
           FROM "Client"
          WHERE ("Client".auth_user_id = auth.uid()))) OR (c.expert_id IN ( SELECT "Expert".id
           FROM "Expert"
          WHERE ("Expert".auth_user_id = auth.uid()))))))                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Politiques RLS créées | public     | user_sessions                 | Users can delete their own sessions                       | PERMISSIVE | {public}             | DELETE | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | user_sessions                 | Users can insert their own sessions                       | PERMISSIVE | {public}             | INSERT | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Politiques RLS créées | public     | user_sessions                 | Users can update their own sessions                       | PERMISSIVE | {public}             | UPDATE | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Politiques RLS créées | public     | user_sessions                 | Users can view their own sessions                         | PERMISSIVE | {public}             | SELECT | ((auth.uid())::text = (user_id)::text)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |



-- Compter les politiques par table
SELECT 
  'Nombre de politiques par table' as verification,
  tablename,
  COUNT(*) as nombre_politiques
FROM pg_policies
WHERE schemaname = 'public'
GROUP BY tablename
ORDER BY nombre_politiques DESC, tablename;

| verification                   | tablename                     | nombre_politiques |
| ------------------------------ | ----------------------------- | ----------------- |
| Nombre de politiques par table | Client                        | 19                |
| Nombre de politiques par table | Expert                        | 15                |
| Nombre de politiques par table | ClientProduitEligible         | 11                |
| Nombre de politiques par table | ApporteurAffaires             | 10                |
| Nombre de politiques par table | RDV                           | 7                 |
| Nombre de politiques par table | RDV_Produits                  | 7                 |
| Nombre de politiques par table | Reminder                      | 6                 |
| Nombre de politiques par table | contact_messages              | 6                 |
| Nombre de politiques par table | Appointment                   | 5                 |
| Nombre de politiques par table | ClientExpert                  | 5                 |
| Nombre de politiques par table | GEDDocument                   | 5                 |
| Nombre de politiques par table | dossier_timeline              | 5                 |
| Nombre de politiques par table | expertassignment              | 5                 |
| Nombre de politiques par table | ApporteurNotification         | 4                 |
| Nombre de politiques par table | ClientNotification            | 4                 |
| Nombre de politiques par table | ClientProcessDocument         | 4                 |
| Nombre de politiques par table | Dossier                       | 4                 |
| Nombre de politiques par table | ExpertNotification            | 4                 |
| Nombre de politiques par table | UserDevices                   | 4                 |
| Nombre de politiques par table | admin_messages                | 4                 |
| Nombre de politiques par table | notification                  | 4                 |
| Nombre de politiques par table | user_sessions                 | 4                 |
| Nombre de politiques par table | AdminAuditLog                 | 3                 |
| Nombre de politiques par table | ProduitEligible               | 3                 |
| Nombre de politiques par table | UserNotificationPreferences   | 3                 |
| Nombre de politiques par table | expertaccesslog               | 3                 |
| Nombre de politiques par table | Admin                         | 2                 |
| Nombre de politiques par table | AdminNotificationStatus       | 2                 |
| Nombre de politiques par table | ApporteurCommission           | 2                 |
| Nombre de politiques par table | ComplianceControl             | 2                 |
| Nombre de politiques par table | DFSQuestions                  | 2                 |
| Nombre de politiques par table | DFSRules                      | 2                 |
| Nombre de politiques par table | DocumentActivity              | 2                 |
| Nombre de politiques par table | EligibilityChanges            | 2                 |
| Nombre de politiques par table | EligibilityRules              | 2                 |
| Nombre de politiques par table | ExpertCategory                | 2                 |
| Nombre de politiques par table | GEDDocumentLabel              | 2                 |
| Nombre de politiques par table | GEDDocumentVersion            | 2                 |
| Nombre de politiques par table | QuestionExploration           | 2                 |
| Nombre de politiques par table | Specialization                | 2                 |
| Nombre de politiques par table | ValidationState               | 2                 |
| Nombre de politiques par table | WorkflowInstance              | 2                 |
| Nombre de politiques par table | WorkflowTemplate              | 2                 |
| Nombre de politiques par table | audit_logs                    | 2                 |
| Nombre de politiques par table | datasubjectrequest            | 2                 |
| Nombre de politiques par table | document_sections             | 2                 |
| Nombre de politiques par table | expert_client_email_scheduled | 2                 |
| Nombre de politiques par table | expert_client_email_sequences | 2                 |
| Nombre de politiques par table | expert_client_emails          | 2                 |
| Nombre de politiques par table | expert_client_emails_received | 2                 |
| Nombre de politiques par table | expertcampaign                | 2                 |
| Nombre de politiques par table | expertcriteria                | 2                 |
| Nombre de politiques par table | invoice                       | 2                 |
| Nombre de politiques par table | iso_reports                   | 2                 |
| Nombre de politiques par table | notification_preferences      | 2                 |
| Nombre de politiques par table | paymentrequest                | 2                 |
| Nombre de politiques par table | promotionbanner               | 2                 |
| Nombre de politiques par table | pushnotification              | 2                 |
| Nombre de politiques par table | terminal_logs                 | 2                 |
| Nombre de politiques par table | AdminNotification             | 1                 |
| Nombre de politiques par table | Cabinet                       | 1                 |
| Nombre de politiques par table | CabinetMember                 | 1                 |
| Nombre de politiques par table | CabinetMemberProduit          | 1                 |
| Nombre de politiques par table | CabinetProduitEligible        | 1                 |
| Nombre de politiques par table | CabinetTeamStat               | 1                 |
| Nombre de politiques par table | CalendarPreferences           | 1                 |
| Nombre de politiques par table | ClientProduitEligibleShare    | 1                 |
| Nombre de politiques par table | ClientStatut                  | 1                 |
| Nombre de politiques par table | DossierComment                | 1                 |
| Nombre de politiques par table | DossierHistorique             | 1                 |
| Nombre de politiques par table | EmailEvent                    | 1                 |
| Nombre de politiques par table | EmailQueue                    | 1                 |
| Nombre de politiques par table | EmailTracking                 | 1                 |
| Nombre de politiques par table | EventInvitation               | 1                 |
| Nombre de politiques par table | ExpertAlert                   | 1                 |
| Nombre de politiques par table | ExpertProduitEligible         | 1                 |
| Nombre de politiques par table | GEDDocumentPermission         | 1                 |
| Nombre de politiques par table | GEDUserDocumentFavorite       | 1                 |
| Nombre de politiques par table | GoogleCalendarIntegration     | 1                 |
| Nombre de politiques par table | GoogleCalendarSyncLog         | 1                 |
| Nombre de politiques par table | ProductCalculationRules       | 1                 |
| Nombre de politiques par table | ProductSpecificRates          | 1                 |
| Nombre de politiques par table | Question                      | 1                 |
| Nombre de politiques par table | QuestionnaireQuestion         | 1                 |
| Nombre de politiques par table | RDV_Invitations               | 1                 |
| Nombre de politiques par table | RDV_Participants              | 1                 |
| Nombre de politiques par table | RDV_Reminders                 | 1                 |
| Nombre de politiques par table | RDV_Report                    | 1                 |
| Nombre de politiques par table | RDV_Task                      | 1                 |
| Nombre de politiques par table | RDV_Timeline                  | 1                 |
| Nombre de politiques par table | SharedClientDocument          | 1                 |
| Nombre de politiques par table | SimulationProcessed           | 1                 |
| Nombre de politiques par table | SimulatorFollowUp             | 1                 |
| Nombre de politiques par table | TICPEAdvancedRules            | 1                 |
| Nombre de politiques par table | TICPEBenchmarks               | 1                 |
| Nombre de politiques par table | TICPERates                    | 1                 |
| Nombre de politiques par table | TICPESectors                  | 1                 |
| Nombre de politiques par table | TICPESimulationResults        | 1                 |
| Nombre de politiques par table | TICPEUsageScenarios           | 1                 |
| Nombre de politiques par table | TICPEVehicleTypes             | 1                 |


-- ============================================================================
-- 6. RECOMMANDATIONS
-- ============================================================================

SELECT 
  'RECOMMANDATIONS' as section,
  '1. Tester la connexion avec chaque type d''utilisateur (client, expert, admin, apporteur)' as recommandation_1,
  '2. Vérifier que les utilisateurs peuvent toujours accéder à leurs propres données' as recommandation_2,
  '3. Vérifier que les utilisateurs ne peuvent PAS accéder aux données d''autres utilisateurs' as recommandation_3,
  '4. Tester les vues pour s''assurer qu''elles fonctionnent toujours' as recommandation_4,
  '5. Surveiller les logs d''erreur après déploiement' as recommandation_5;
